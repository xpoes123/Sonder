{% extends 'music/base.html' %}
{% load static %}

{% block extra_head %}
    <link rel="stylesheet" type="text/css" href="{% static 'music/css/recommendations.css' %}">
{% endblock %}

{% block content %}
    <div class="container">
        {% if recommendations %}
            {% for song in recommendations %}
                <div class="song-card" id="song{{ forloop.counter }}">
                    <!-- Song Title and Artist -->
                    <h2>{{ song.name }}</h2>
                    <p class="artist-name">{{ song.artist }}</p>

                    <!-- Song Image -->
                    {% if song.image %}
                        <a href="{{ song.link }}" target="_blank"><img src="{{ song.image }}" alt="{{ song.name }}"></a>
                    {% else %}
                        <p>No image available.</p>
                    {% endif %}

                    <!-- Audio Preview -->
                    {% if song.preview %}
                        <audio controls>
                            <source src="{{ song.preview }}" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                    {% else %}
                        <p>No preview available.</p>
                    {% endif %}

                    <!-- Toggle Profile -->
                    <button class="toggle-profile-btn" onclick="toggleProfile('profile{{ forloop.counter }}')">
                        Show Dating Profile
                    </button>

                    <!-- Dating Profile -->
                    <div class="dating-profile" id="profile{{ forloop.counter }}" style="display: none;">
                        <h3>Dating Profile</h3>
                        <p><strong>Gender:</strong> {{ song.dating_profile.gender }}</p>
                        <p><strong>Sexuality:</strong> {{ song.dating_profile.sexuality }}</p>
                        <p><strong>Height:</strong> {{ song.dating_profile.height }}</p>
                        <p><strong>Biography:</strong> {{ song.dating_profile.biography }}</p>
                        <p><strong>Interests:</strong> {{ song.dating_profile.interest_list }}</p>
                        <p><strong>Age:</strong> {{ song.dating_profile.age }}</p>
                        <p><strong>Occupation:</strong> {{ song.dating_profile.occupation }}</p>
                        <p><strong>Location:</strong> {{ song.dating_profile.location }}</p>
                    </div>

                    <!-- Like and Dislike Buttons -->
                    <div class="nav-buttons">
                        <form method="GET" action="{% url 'music:recommend' %}">
                            <input type="hidden" name="action" value="dislike">
                            <input type="hidden" name="song_id" value="{{ song.spotify_id }}">
                            <button type="submit" class="dislike-btn">Dislike</button>
                        </form>
                        <form method="GET" action="{% url 'music:recommend' %}">
                            <input type="hidden" name="artist" value="{{ song.artist }}">
                            <input type="hidden" name="stats" value="{{ song.stats }}">
                            <input type="hidden" name="song_id" value="{{ song.spotify_id }}">
                            <input type="hidden" name="action" value="like">
                            <button type="submit" class="like-btn">Like</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p>No recommendations available based on your input.</p>
        {% endif %}

        {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                    <li class="{{ message.tags }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>

    <!-- JavaScript for Toggle Functionality -->
    <script>
        function toggleProfile(profileId) {
            var profile = document.getElementById(profileId);
            var button = event.target;
            if (profile.style.display === "block") {
                profile.style.display = "none";
                button.textContent = "Show Dating Profile";
            } else {
                profile.style.display = "block";
                button.textContent = "Hide Dating Profile";
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            var firstSong = document.querySelector('.song-card');
            if (firstSong) {
                var audio = firstSong.querySelector('audio');
                if (audio) {
                    audio.play().catch(function(error) {
                        console.log("Autoplay was prevented:", error);
                    });
                }
            }
        });
    </script>
{% endblock %}
